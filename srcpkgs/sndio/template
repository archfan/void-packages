# Template file for 'sndio'
pkgname=sndio
version=1.7.0
revision=1
build_style=configure
configure_args="--prefix=/usr --enable-alsa"
makedepends="alsa-lib-devel"
short_desc="Small audio and MIDI framework part of the OpenBSD project"
maintainer="archfan <ad-min@mailbox.org>"
license="ISC"
homepage="http://www.sndio.org/"
distfiles="http://www.sndio.org/${pkgname}-${version}.tar.gz"
checksum=dda4e3d0879423ed57923975ba74668cbb9299939cad579b0ac64a4b01535552
system_accounts="sndiod"
sndiod_descr="sndio daemon"
sndiod_pgroup="audio"

post_extract() {
	# remove minor version from SONAME to avoid rebuilding
	# packages, the minor version just added new symbols.
	vsed -e '/-soname=/s/\.\\${MIN}//' -i configure
}

post_install() {
	vsv sndiod
	sed -n '/Copyright/,/PERFORMANCE/p' <sndiod/sndiod.c >LICENSE
	vlicense LICENSE

	# compatibility symlink, needed until the libsndio.so.7
	# SONAME is used by everything.
	ln -sf libsndio.so.7.1 libsndio.so.7.0
	vcopy libsndio.so.7.0 usr/lib

	# MAJOR SONAME to avoid rebuilds
	ln -sf libsndio.so.7.1 libsndio.so.7
	vcopy libsndio.so.7 usr/lib

}


libsndio_package() {
	short_desc+=" -- library"
	pkg_install() {
		vmove "usr/lib/libsndio.so.*"
	}
}
sndio-devel_package() {
	depends="libsndio>=${version}_${revision}"
	short_desc+=" -- development files"
	pkg_install() {
		vmove usr/include
		vmove "usr/share/man/man3/*.3"
		vmove "usr/lib/*.so"
	}
}
